---
import BaseHashPage from "../components/BaseHashPage.astro";
import InputEncodingSelect from "../components/InputEncodingSelect.astro";
import OutputEncodingSelect from "../components/OutputEncodingSelect.astro";
import HMACSettings from "../components/HMACSettings.astro";

interface Props {
  title: string;
  description: string;
  algorithmName: string;
  jsFile?: string;
  activePage: string;
  methodWrapper?: string;
}

const { title, description, algorithmName, jsFile = "crypto-js.js", activePage, methodWrapper } = Astro.props;

// Pre-calculate the script source path
const scriptSrc = jsFile.startsWith("http") ? jsFile : `/js/${jsFile}`;
const methodCode = methodWrapper || `window['${algorithmName}']`;
---

<BaseHashPage title={title} description={description} activePage={activePage}>
  <div class="setting">
    <label for="input-type">Input Encoding</label>
    <InputEncodingSelect id="input-type" dataShare="input_type" dataAutoUpdate={true} />
  </div>
  <div class="setting">
    <label for="output-type">Output Encoding</label>
    <OutputEncodingSelect id="output-type" dataShare="output_type" dataAutoUpdate={true} />
  </div>
  <HMACSettings />

  <!-- Hash Page Loader -->
  <script is:inline slot="scripts" src="/js/hash-page-loader.js"></script>

  <script is:inline slot="scripts" define:vars={{ scriptSrc, algorithmName, methodCode, methodWrapper }}>
    // Initialize hash page loader
    const loader = new HashPageLoader({
      scriptSrc,
      algorithmName,
      methodCode,
      methodWrapper,
    });

    // Load all required scripts
    loader.loadScripts();
  </script>
</BaseHashPage>
