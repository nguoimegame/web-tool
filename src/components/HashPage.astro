---
import BaseHashPage from "../components/BaseHashPage.astro";

interface Props {
  title: string;
  description: string;
  algorithmName: string;
  jsFile?: string;
  activePage: string;
  methodWrapper?: string;
}

const { title, description, algorithmName, jsFile = "crypto-js.js", activePage, methodWrapper } = Astro.props;

// Pre-calculate the script source path
const scriptSrc = jsFile.startsWith("http") ? jsFile : `/js/${jsFile}`;
const methodCode = methodWrapper || `window['${algorithmName}']`;
---

<BaseHashPage title={title} description={description} activePage={activePage}>
  <div class="setting">
    <label for="input-type">Input Encoding</label>
    <select data-toggle="encoding" id="input-type" data-remember="input-type" data-share="input_type" data-auto-update>
      <optgroup label="Binary">
        <option value="hex">Hex</option>
        <option value="base64" data-load-encoding="base64"> Base64 </option>
      </optgroup>
      <optgroup label="Text">
        <option value="utf-8" selected>UTF-8</option>
        <option value="utf-16le" data-load-encoding="1">UTF-16LE</option>
        <option value="utf-16be" data-load-encoding="1">UTF-16BE</option>
        <option value="ibm866" data-load-encoding="2">IBM866</option>
        <option value="iso-8859-2" data-load-encoding="2">ISO-8859-2</option>
        <option value="iso-8859-3" data-load-encoding="2">ISO-8859-3</option>
        <option value="iso-8859-4" data-load-encoding="2">ISO-8859-4</option>
        <option value="iso-8859-5" data-load-encoding="2">ISO-8859-5</option>
        <option value="iso-8859-6" data-load-encoding="2">ISO-8859-6</option>
        <option value="iso-8859-7" data-load-encoding="2">ISO-8859-7</option>
        <option value="iso-8859-8" data-load-encoding="2">ISO-8859-8</option>
        <option value="iso-8859-8-i" data-load-encoding="2">ISO-8859-8-I</option>
        <option value="iso-8859-10" data-load-encoding="2">ISO-8859-10</option>
        <option value="iso-8859-13" data-load-encoding="2">ISO-8859-13</option>
        <option value="iso-8859-14" data-load-encoding="2">ISO-8859-14</option>
        <option value="iso-8859-15" data-load-encoding="2">ISO-8859-15</option>
        <option value="iso-8859-16" data-load-encoding="2">ISO-8859-16</option>
        <option value="koi8-r" data-load-encoding="2">KOI8-R</option>
        <option value="koi8-u" data-load-encoding="2">KOI8-U</option>
        <option value="macintosh" data-load-encoding="2">macintosh</option>
        <option value="windows-874" data-load-encoding="2">Windows-874</option>
        <option value="windows-1250" data-load-encoding="2">Windows-1250</option>
        <option value="windows-1251" data-load-encoding="2">Windows-1251</option>
        <option value="windows-1252" data-load-encoding="2">Windows-1252</option>
        <option value="windows-1253" data-load-encoding="2">Windows-1253</option>
        <option value="windows-1254" data-load-encoding="2">Windows-1254</option>
        <option value="windows-1255" data-load-encoding="2">Windows-1255</option>
        <option value="windows-1256" data-load-encoding="2">Windows-1256</option>
        <option value="windows-1257" data-load-encoding="2">Windows-1257</option>
        <option value="windows-1258" data-load-encoding="2">Windows-1258</option>
        <option value="x-mac-cyrillic" data-load-encoding="2">x-mac-cyrillic</option>
        <option value="gbk" data-load-encoding="2">GBK</option>
        <option value="gb18030" data-load-encoding="2">gb18030</option>
        <option value="big5" data-load-encoding="2">Big5</option>
        <option value="euc-jp" data-load-encoding="2">EUC-JP</option>
        <option value="iso-2022-jp" data-load-encoding="2">ISO-2022-JP</option>
        <option value="shift_jis" data-load-encoding="2">Shift_JIS</option>
        <option value="euc-kr" data-load-encoding="2">EUC-KR</option>
        <option value="x-user-defined" data-load-encoding="2">x-user-defined</option>
      </optgroup>
    </select>
  </div>
  <div class="setting">
    <label for="output-type">Output Encoding</label>
    <select data-toggle="encoding" id="output-type" data-remember="output-type" data-share="output_type" data-auto-update data-type="hex">
      <option value="hex">Hex (Lower Case)</option>
      <option value="hex_upper">Hex (Upper Case)</option>
      <option value="base64" data-load-encoding="base64"> Base64 </option>
    </select>
  </div>
  <div class="setting">
    <label class="switcher">
      <input type="checkbox" value="1" id="hmac-enabled" data-remember="hmac-enabled" data-share="hmac_enabled" data-auto-update />
      <div class="toggle"></div>
      <span>Enable HMAC</span>
    </label>
  </div>
  <details class="setting-group" id="hmac" style="display:none" open>
    <summary>HMAC</summary>
    <div class="setting">
      <label for="hmac-input-type">Encoding</label>
      <select data-toggle="encoding" id="hmac-input-type" data-remember="hmac-input-type" data-share="hmac_input_type" data-auto-update>
        <optgroup label="Binary">
          <option value="hex">Hex</option>
          <option value="base64" data-load-encoding="base64"> Base64 </option>
        </optgroup>
        <optgroup label="Text">
          <option value="utf-8" selected>UTF-8</option>
          <option value="utf-16le" data-load-encoding="1"> UTF-16LE </option>
          <option value="utf-16be" data-load-encoding="1"> UTF-16BE </option>
        </optgroup>
      </select>
    </div>
    <div class="setting">
      <label for="hmac-key">Key</label>
      <input type="text" id="hmac-key" data-remember="hmac-key" data-share="hmac_key" data-encoding-from="#hmac-input-type" data-auto-update />
    </div>
  </details>
  <script is:inline>
    ++waitLoadCount;
    delayScripts.push({
      src: "/js/hmac.js?v=2",
    });
  </script>

  <!-- Hash Page Loader -->
  <script is:inline slot="scripts" src="/js/hash-page-loader.js"></script>

  <script is:inline slot="scripts" define:vars={{ scriptSrc, algorithmName, methodCode, methodWrapper }}>
    // Initialize hash page loader
    const loader = new HashPageLoader({
      scriptSrc,
      algorithmName,
      methodCode,
      methodWrapper,
    });

    // Load all required scripts
    loader.loadScripts();
  </script>
</BaseHashPage>
