---
import BaseHashPage from '../components/BaseHashPage.astro';
import OutputEncodingSelect from './OutputEncodingSelect.astro';
import HMACSettings from './HMACSettings.astro';
import FileTypeSelect from './FileTypeSelect.astro';

interface Props {
    title: string;
    description: string;
    algorithmName: string;
    jsFile: string;
    activePage: string;
    methodWrapper?: string;
}

const { title, description, algorithmName, jsFile, activePage, methodWrapper } = Astro.props;

// Pre-calculate the script source path
const scriptSrc = jsFile.startsWith('http') ? jsFile : `/js/${jsFile}`;
const methodCode = methodWrapper || `window['${algorithmName.toLowerCase().replace(/\//g, '_').replace(/-/g, '_')}']`;
---

<BaseHashPage title={title} description={description} activePage={activePage} isUseFile={true}>
    <div class="setting">
        <label for="file-type">Input Type</label>
        <FileTypeSelect id="file-type" dataRemember="file-type" dataAutoUpdate={true} />
    </div>
    
    <div class="setting">
        <label for="output-type">Output Encoding</label>
        <OutputEncodingSelect id="output-type" dataShare="output_type" dataAutoUpdate={true} />
    </div>
    
    <HMACSettings />
    
    <!-- File Hash Page Loader -->
    <script is:inline slot="scripts" src="/js/file-hash-page-loader.js"></script>
    
    <script is:inline slot="scripts" define:vars={{ scriptSrc, algorithmName, methodCode, methodWrapper }}>
        // Initialize file hash page loader
        const loader = new FileHashPageLoader({
            scriptSrc,
            algorithmName,
            methodCode,
            methodWrapper
        });
        
        // Load all required scripts
        loader.loadScripts();
    </script>
</BaseHashPage>
